Amble App

Overview

Amble is a minimal SwiftUI app that displays the number of steps taken in the last minute using Core Motion. It also shows the current motion activity classification (e.g., Walking, Running, Stationary).

Structure

- Amble/Amble/AmbleApp.swift: App entry point. Hosts the root `ContentView`.
- Amble/Amble/ContentView.swift: Root TabView: `StepsView` and `AppsView`.
- Amble/Amble/AppsView.swift: Searchable list of installed popular apps (via URL schemes) with selection persisted to local storage. Includes Screen Time integration for selecting from all installed apps.
- Amble/Amble/ScreenTimeManager.swift: Manages Screen Time (FamilyControls) authorization and selected app tokens.
- Amble/Amble/Assets.xcassets: App assets and icon.
- Amble/Amble.xcodeproj: Xcode project configuration (Info keys generated by build settings).

Key Features

- Shows steps counted in the rolling last 60 seconds.
- Displays current activity state using `CMMotionActivityManager`.
- Polls pedometer once per second using `CMPedometer.queryPedometerData(from:to:)` for accurate sliding-window counts.
- Sends a local notification when steps in the last X seconds are 0; X is adjustable in-app (5–600s).
- Apps tab: surfaces selected popular apps (Instagram, YouTube, Facebook, Snapchat, etc.) at the top when installed; supports search and persistent selection via `UserDefaults`.
- Screen Time integration: Uses FamilyControls framework to allow users to select from all installed apps on their device via the native Screen Time picker. Selected app tokens are persisted locally.

Permissions & Background

- Motion & Fitness permission is required. A usage description is configured via build settings: `NSMotionUsageDescription` → "Motion data is used to count your steps."
- Core Motion pedometer/activity updates can continue in the background on supported devices without additional background modes. No extra background modes are enabled by default.
 - On first launch, the app explicitly triggers the Motion & Fitness permission prompt by issuing a minimal 1s pedometer/activity query when status is `.notDetermined`.
- For installed app detection, the app uses `UIApplication.canOpenURL` against a curated set of URL schemes. The following schemes are declared under `LSApplicationQueriesSchemes`: instagram, youtube, fb, snapchat, twitter, tiktok, whatsapp, fb-messenger, reddit, pinterest, nflx, spotify.
- Screen Time (FamilyControls) requires the Family Controls capability to be enabled in Xcode. This must be added manually: Project Settings → Signing & Capabilities → + Capability → Family Controls. Note: This capability requires special App Store approval and is intended for parental control apps.

How It Works

- On appear, `ContentView` starts a `PedometerViewModel` that:
  - Starts activity updates if available.
  - Requests notification permission for local alerts.
  - Schedules a 1s timer to query pedometer data from `now - windowSeconds` to `now` and updates `stepsLastMinute`.
  - If steps are 0 for the configured window, posts a local notification (debounced to at most once per window).

Troubleshooting

- If the steps always show 0 or permission warnings appear:
  - Ensure Motion & Fitness is enabled in Settings → Privacy.
  - Test on a physical device (Core Motion is limited in Simulator).

Change Log

- 2025-11-06: Initial implementation of pedometer/activity UI and motion permission description.
- 2025-11-06: Added inactivity window slider and local notification when steps hit 0.
- 2025-11-06: Added Apps tab with search, prioritization, and persistent selections.
- 2025-11-06: Added Screen Time (FamilyControls) integration for selecting from all installed apps via native picker.


